(this["webpackJsonpinsta-clone"]=this["webpackJsonpinsta-clone"]||[]).push([[4],{135:function(e,t,a){},136:function(e,t,a){},138:function(e,t,a){"use strict";var n=a(10),c=a(0),l=a.n(c),o=(a(135),a(136),a(133)),i=a.n(o),r=a(137),s=a.n(r),u=a(127),m=a(18),p=a(32),d=a.n(p),f=a(24),h=a(140),g=a(131),E=Object(h.a)((function(e){return{root:{display:"flex","& > *":{margin:e.spacing(1)}},comment:{width:e.spacing(4),height:e.spacing(4)}}}));var v=function(e){var t,a,o=e.comment,i=E(),r=l.a.useState(null),s=Object(n.a)(r,2),u=s[0],p=s[1];return Object(c.useEffect)((function(){m.b.collection("users").doc(o.data.userUid).get().then((function(e){p({user:e.data()})}))}),[]),l.a.createElement("li",null,l.a.createElement(g.a,{className:i.comment,alt:"user",src:null===u||void 0===u||null===(t=u.user)||void 0===t?void 0:t.picUrl}),l.a.createElement("span",{className:"post__comment__user"},null===u||void 0===u||null===(a=u.user)||void 0===a?void 0:a.displayName),l.a.createElement("span",{className:"comment"},o.data.comment))};var b=function(e){var t=e.post,a=Object(c.useContext)(f.a).currentUser,o=l.a.useState(!1),r=Object(n.a)(o,2),p=r[0],h=r[1],g=l.a.useState(""),E=Object(n.a)(g,2),b=E[0],_=E[1],N=l.a.useState([]),U=Object(n.a)(N,2),O=U[0],j=U[1],S=l.a.useState(!1),k=Object(n.a)(S,2),C=k[0],w=k[1];return Object(c.useEffect)((function(){_(""),m.b.collection("posts").doc(t.id).collection("comments").orderBy("createdAt","desc").onSnapshot((function(e){var t=[];e.forEach((function(e){t.push({id:e.id,data:e.data()})})),j(t)}))}),[t]),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"comments"},p&&l.a.createElement("ul",{className:"all__comments"},l.a.createElement("li",null,l.a.createElement("span",{className:"comments__head"},"Comments"),l.a.createElement("span",{onClick:function(){return h(!p)},className:"comment__close"},l.a.createElement(i.a,null))),O.map((function(e){return l.a.createElement(v,{key:e.id,comment:e})}))),p?"":l.a.createElement("p",{className:"view__comments",onClick:function(){return h(!p)}},"View all comments")),l.a.createElement("div",{className:"user__comment"},l.a.createElement("form",null,l.a.createElement("input",{type:"text",name:"comment",id:"comment",value:b,onChange:function(e){return _(e.target.value)},placeholder:"Type comment here...",autoComplete:"off"}),l.a.createElement("button",{type:"submit",onClick:function(e){e.preventDefault(),b.length>0&&(w(!0),m.b.collection("posts").doc(t.id).collection("comments").add({userUid:a.uid,comment:b,createdAt:d.a.firestore.FieldValue.serverTimestamp()}).then((function(e){w(!1),_("")})).catch((function(e){w(!1),_(""),console.error("Error adding document: ",e)})))}},C?l.a.createElement(u.a,{size:24,color:"inherit"}):l.a.createElement(s.a,{fontSize:"small",color:"action"})))))},_=Object(h.a)((function(e){return{root:{display:"flex","& > *":{margin:e.spacing(1)}},small:{width:e.spacing(5),height:e.spacing(5)}}}));t.a=function(e){var t=e.post,a=l.a.useState(null),o=Object(n.a)(a,2),i=o[0],r=o[1],s=l.a.useState(!1),u=Object(n.a)(s,2),p=u[0],d=u[1],f=_();return Object(c.useEffect)((function(){m.b.collection("users").doc(t.data.userUid).get().then((function(e){r({username:e.data().username,postUserPicUrl:e.data().picUrl})}))}),[t.id]),l.a.createElement("div",{className:"posts"},l.a.createElement("div",{className:"post__head"},l.a.createElement(g.a,{className:f.small,alt:null===i||void 0===i?void 0:i.username,src:null===i||void 0===i?void 0:i.postUserPicUrl}),l.a.createElement("span",{className:"post__username"},null===i||void 0===i?void 0:i.username)),l.a.createElement("div",{className:"postImg__container"},l.a.createElement("img",{src:t.data.postUrl,onLoad:d,alt:"post-img",className:"post__img"}),l.a.createElement("img",Object.assign({src:t.data.postThumbnailUrl,alt:"post-thumbnail"},p&&{style:{opacity:"0"}},{className:"post__thumbnail"}))),l.a.createElement("p",{className:"post__caption"},l.a.createElement("span",{className:"post__user"},null===i||void 0===i?void 0:i.username),l.a.createElement("span",null,t.data.caption)),l.a.createElement(b,{post:t}))}},141:function(e,t,a){},142:function(e,t,a){},147:function(e,t,a){},156:function(e,t,a){"use strict";a.r(t);var n=a(10),c=a(0),l=a.n(c),o=(a(141),a(140)),i=a(133),r=a.n(i),s=a(131),u=a(127),m=a(139),p=a.n(m),d=(a(142),a(138)),f=a(143),h=a.n(f),g=a(144),E=a.n(g);var v=function(e){var t=e.clickedLeft,a=e.clickedRight,n=e.close,c=e.picData;return l.a.createElement("div",{className:"view__pic"},l.a.createElement("div",{className:"viewpic__close",onClick:function(){return n(null)}},l.a.createElement(r.a,{fontSize:"large"})),l.a.createElement("div",{className:"left__chivron",onClick:t},l.a.createElement(h.a,{fontSize:"large"})),l.a.createElement(d.a,{post:c}),l.a.createElement("div",{className:"right__chivron",onClick:a},l.a.createElement(E.a,{fontSize:"large"})))},b=a(23),_=a(145),N=a(146),U=a(152),O=a(151),j=(a(147),a(148)),S=a.n(j),k=(a(149),a(18)),C=a(32),w=a.n(C),y=a(155),x=a(150),z=function(e){Object(U.a)(a,e);var t=Object(O.a)(a);function a(e){var n;return Object(_.a)(this,a),(n=t.call(this,e)).handleFileInput=function(e){if(e.target.files&&e.target.files[0]){var t=new FileReader;t.addEventListener("load",(function(){n.setState({file:t.result});var e=new S.a(n.imageElement.current,{zoomable:!1,scalable:!1,aspectRatio:1,crop:function(){var t=e.getCroppedCanvas();n.setState({imageDestination:t.toDataURL("image/jpg")})}})}));Object(x.a)(e.target.files[0],{maxSizeMB:.5,maxWidthOrHeight:640,useWebWorker:!0}).then((function(e){t.readAsDataURL(e)}))}},n.handleUpload=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=null,c=null;n.props.uploadProfile?a=k.c.ref("users/".concat(n.name)):(a=k.c.ref("posts/".concat(n.name,"/").concat(n.name)),c=k.c.ref("posts/".concat(n.name,"/").concat(n.thumbnailName)));var l=null,o=null;!t&&n.props.uploadProfile?l=a.put(e):(l=a.put(e),o=c.put(t)),l.on("state_changed",(function(e){var t=e.bytesTransferred/e.totalBytes*100;n.setState({progress:t})}),(function(e){console.log("error in upload")}),(function(){l.snapshot.ref.getDownloadURL().then((function(e){n.props.uploadProfile?k.b.collection("users").doc(n.props.currentUser.uid).update({picUrl:e}).then((function(e){n.setState({uploading:!1}),n.props.setViewUploader(!1)})).catch((function(e){n.setState({uploading:!1})})):o.snapshot.ref.getDownloadURL().then((function(t){k.b.collection("posts").add({userUid:n.props.currentUser.uid,postUrl:e,postThumbnailUrl:t,caption:n.state.caption,createdAt:w.a.firestore.FieldValue.serverTimestamp()}).then((function(e){n.setState({uploading:!1}),n.props.setViewUploader(!1)})).catch((function(e){n.setState({uploading:!1})}))}))}))}))},n.compressImagesBerforeUpload=function(){n.setState({uploading:!0});var e=null,t=null;n.props.uploadProfile?e={maxSizeMB:.1,maxWidthOrHeight:100,useWebWorker:!0}:(t={maxSizeMB:.05,maxWidthOrHeight:20,useWebWorker:!0},e={maxSizeMB:.4,maxWidthOrHeight:640,useWebWorker:!0}),x.a.getFilefromDataUrl(n.state.imageDestination,"file.jpg").then((function(a){Object(x.a)(a,e).then((function(e){t?Object(x.a)(a,t).then((function(t){n.handleUpload(e,t)})):n.handleUpload(e)}))}))},n.triggerClick=function(){n.fileRef.current.click()},n.state={imageDestination:"",file:null,caption:"",progress:0,uploading:!1},n.imageElement=l.a.createRef(),n.fileRef=l.a.createRef(),n.props.uploadProfile?n.name=""+n.props.currentUser.uid:(n.name=n.props.currentUser.uid+"-"+Date.now(),n.thumbnailName=n.props.currentUser.uid+"-"+Date.now()+"-thumbnail"),n}return Object(N.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"upload__image"},l.a.createElement("div",{className:"upload__img"},this.state.file?l.a.createElement("div",{className:"cropper"},l.a.createElement("img",{ref:this.imageElement,src:this.state.file,alt:"upload"})):l.a.createElement(l.a.Fragment,null,l.a.createElement("input",{type:"file",hidden:!0,name:"image",id:"image",ref:this.fileRef,onChange:this.handleFileInput}),l.a.createElement("h3",{onClick:this.triggerClick},"Choose file"))),l.a.createElement(y.a,{variant:"determinate",value:this.state.progress}),l.a.createElement("div",{className:"caption__input"},l.a.createElement("input",{type:"text",name:"caption",id:"caption",value:this.state.caption,onChange:function(t){return e.setState({caption:t.target.value})},placeholder:"caption",autoComplete:"off"}),l.a.createElement("button",{className:"upload__button",disabled:!this.state.file,onClick:this.compressImagesBerforeUpload},this.state.uploading?l.a.createElement(u.a,{size:20,color:"inherit"}):l.a.createElement(p.a,{color:"action"}))),l.a.createElement("button",{className:"cancel__button",onClick:function(){return e.props.setViewUploader(!1)}},"Cancel"))}}]),a}(l.a.Component),D=a(24),R=Object(o.a)((function(e){return{root:{display:"flex","& > *":{margin:e.spacing(1)}},pic:{width:e.spacing(14),height:e.spacing(14),marginLeft:e.spacing(2)}}}));t.default=function(){var e=R(),t=Object(c.useContext)(D.a).currentUser,a=l.a.useState(null),o=Object(n.a)(a,2),i=o[0],m=o[1],d=l.a.useState(!1),f=Object(n.a)(d,2),h=f[0],g=f[1],E=l.a.useState([]),_=Object(n.a)(E,2),N=_[0],U=_[1],O=l.a.useState(!0),j=Object(n.a)(O,2),S=j[0],C=j[1],w=l.a.useState(!1),y=Object(n.a)(w,2),x=y[0],W=y[1];return Object(c.useEffect)((function(){k.b.collection("posts").where("userUid","==",t.uid).get().then((function(e){C(!1);var t=[];e.forEach((function(e){t.push({id:e.id,data:e.data()})})),U(t)})).catch((function(e){console.log("Error getting documents: ",e)}))}),[h]),l.a.createElement("div",{className:"profile__container"},l.a.createElement("div",{className:"profile__close"},l.a.createElement(b.b,{to:"/posts"},l.a.createElement(r.a,{fontSize:"large",style:{color:"#000000"}}))),l.a.createElement(s.a,{className:e.pic,onClick:function(){W(!0),g(!0)},alt:"user",src:t.picUrl}),l.a.createElement("p",{className:"username"},t.username),l.a.createElement("p",{className:"email"},t.email),l.a.createElement("div",{className:"gallery"},l.a.createElement("h5",null,"Gallery"," ",l.a.createElement("span",{onClick:function(){W(!1),g(!0)}},"Upload ",l.a.createElement(p.a,null))),N.length>0&&l.a.createElement("div",{className:"photos"},N.map((function(e){return l.a.createElement("div",{key:e.id,className:"photo",onClick:function(){return m(e)}},l.a.createElement("img",{src:e.data.postUrl,alt:e.id}))}))),S&&l.a.createElement("div",{className:"loading_photos"},l.a.createElement(u.a,{size:50,color:"inherit"})),0===N.length&&!S&&l.a.createElement("h3",{className:"no__photos"},"No Photos")),i&&l.a.createElement(v,{close:m,picData:i,clickedLeft:function(){N.forEach((function(e,t){if(e.id===i.id)if(0===t){var a=N.length-1;m(N[a])}else m(N[t-1])}))},clickedRight:function(){N.forEach((function(e,t){e.id===i.id&&(t===N.length-1?m(N[0]):m(N[t+1]))}))}}),h&&l.a.createElement(z,{uploadProfile:x,setViewUploader:g,currentUser:t}))}}}]);
//# sourceMappingURL=4.422de64f.chunk.js.map